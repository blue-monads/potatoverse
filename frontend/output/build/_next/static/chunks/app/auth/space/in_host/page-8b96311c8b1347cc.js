(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8293],{670:(e,t,a)=>{Promise.resolve().then(a.bind(a,4968))},1886:(e,t,a)=>{"use strict";a.d(t,{$V:()=>C,$c:()=>p,AC:()=>T,B9:()=>B,BA:()=>x,Cs:()=>X,De:()=>L,Ed:()=>j,H1:()=>el,H4:()=>eu,IF:()=>v,K4:()=>h,Kh:()=>ed,Lv:()=>E,MA:()=>R,Nv:()=>en,Om:()=>ea,Oz:()=>d,P6:()=>ei,Pj:()=>G,QD:()=>u,QT:()=>W,Qf:()=>Q,Qk:()=>es,Ql:()=>y,R5:()=>H,Sx:()=>M,T:()=>et,TT:()=>$,TY:()=>ee,Tv:()=>O,U8:()=>U,VG:()=>F,Y3:()=>c,ZN:()=>q,_m:()=>m,ct:()=>K,e0:()=>I,eK:()=>V,eq:()=>g,fB:()=>z,gw:()=>eh,iD:()=>o,iJ:()=>_,iQ:()=>b,iY:()=>J,ir:()=>f,iu:()=>w,j3:()=>k,lB:()=>Y,lo:()=>i,mm:()=>em,no:()=>ef,q0:()=>Z,qR:()=>ex,qf:()=>er,rf:()=>ep,s2:()=>S,sI:()=>ey,tF:()=>N,to:()=>ec,u1:()=>A,uP:()=>P,wz:()=>l,yj:()=>eg,yn:()=>D,z6:()=>eo});var s=a(3464),n=a(3999);let r=s.A.create({baseURL:"/zz/api"}),c=()=>{let e=(0,n.MH)(),t={"Content-Type":"application/json","X-Clacks-Overhead":"Aaron Swartz"};(null==e?void 0:e.accessToken)&&(t.Authorization="TokenV1 ".concat(e.accessToken)),r=s.A.create({baseURL:"/zz/api",headers:t})},o=async(e,t)=>r.post("/core/auth/login",{username:e,password:t}),i=async()=>r.get("/core/user"),l=async e=>r.get("/core/user/".concat(e)),d=async()=>r.get("/core/user/invites"),p=async e=>r.post("/core/user/invites",e),u=async e=>r.delete("/core/user/invites/".concat(e)),g=async e=>r.post("/core/user/invites/".concat(e,"/resend")),f=async e=>r.get("/core/auth/invite/".concat(e)),y=async(e,t)=>r.post("/core/auth/invite/".concat(e),t),m=async e=>r.post("/core/user/create",e),h=async()=>r.get("/core/user/groups"),x=async e=>r.post("/core/user/groups",e),_=async(e,t)=>r.put("/core/user/groups/".concat(e),t),v=async e=>r.delete("/core/user/groups/".concat(e)),b=async e=>r.get("/core/self/portalData/".concat(e)),k=async()=>r.get("/core/self/info"),w=async e=>r.put("/core/self/bio",{bio:e}),j=async e=>r.post("/core/package/install",{url:e}),N=async e=>r.post("/core/package/install/zip",e,{headers:{"Content-Type":"application/zip"}}),z=async(e,t)=>r.post("/core/package/install/embed",{name:e,repo_slug:t}),S=async e=>r.delete("/core/package/".concat(e)),T=async e=>r.post("/core/package/".concat(e,"/dev-token")),C=async e=>{let t=e?"?repo=".concat(encodeURIComponent(e)):"";return r.get("/core/package/list".concat(t))},P=async()=>r.get("/core/repo/list"),D=async()=>r.get("/core/space/installed"),F=async e=>r.get("/core/package/".concat(e,"/info")),L=async(e,t)=>{let a=encodeURIComponent(t);return r.get("/core/engine/space_info/".concat(e,"?host_name=").concat(a.toString()))},A=async(e,t)=>r.post("/core/space/authorize/".concat(e),{space_id:t}),R=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return r.get("/core/vpackage/".concat(e,"/files"),{params:{path:t}})},O=async(e,t)=>r.get("/core/vpackage/".concat(e,"/files/").concat(t,"/download"),{responseType:"blob"}),I=async(e,t)=>r.delete("/core/vpackage/".concat(e,"/files/").concat(t)),U=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=new FormData;return s.append("file",t),s.append("path",a),r.post("/core/vpackage/".concat(e,"/files/upload"),s,{headers:{"Content-Type":"multipart/form-data"}})},B=async function(e,t,a,s){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";await I(e,t);let c=new File([new Blob([a],{type:"text/plain"})],s,{type:"text/plain"}),o=new FormData;return o.append("file",c),o.append("path",n),r.post("/core/vpackage/".concat(e,"/files/upload"),o,{headers:{"Content-Type":"multipart/form-data"}})},Q=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return r.get("/core/space/".concat(e,"/kv"),{params:{offset:t,limit:a}})},H=async(e,t)=>r.get("/core/space/".concat(e,"/kv/").concat(t)),J=async(e,t)=>r.post("/core/space/".concat(e,"/kv"),t),Y=async(e,t,a)=>r.put("/core/space/".concat(e,"/kv/").concat(t),a),E=async(e,t)=>r.delete("/core/space/".concat(e,"/kv/").concat(t)),K=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return r.get("/core/space/".concat(e,"/files"),{params:{path:t}})},q=async(e,t)=>r.get("/core/space/".concat(e,"/files/").concat(t,"/download"),{responseType:"blob"}),M=async(e,t)=>r.delete("/core/space/".concat(e,"/files/").concat(t)),V=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=new FormData;return s.append("file",t),s.append("path",a),r.post("/core/space/".concat(e,"/files/upload"),s,{headers:{"Content-Type":"multipart/form-data"}})},$=async function(e,t,a,s){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";await M(e,t);let c=new File([new Blob([a],{type:"text/plain"})],s,{type:"text/plain"}),o=new FormData;return o.append("file",c),o.append("path",n),r.post("/core/space/".concat(e,"/files/upload"),o,{headers:{"Content-Type":"multipart/form-data"}})},G=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return r.post("/core/space/".concat(e,"/files/folder"),{name:t,path:a})},Z=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments.length>3?arguments[3]:void 0;return r.post("/core/space/".concat(e,"/files/presigned"),{file_name:t,path:a,expiry:s})},W=async(e,t)=>{let a=new FormData;return a.append("file",t),s.A.post("/zz/file/upload-presigned?presigned-key=".concat(e),a,{headers:{"Content-Type":"multipart/form-data"}})},X=async()=>r.get("/core/capability/types"),ee=async(e,t,a)=>r.get("/core/space/".concat(e,"/capabilities"),{params:{...void 0!==t&&{space_id:t},...a&&{capability_type:a}}}),et=async(e,t)=>r.post("/core/space/".concat(e,"/capabilities"),t),ea=async(e,t,a)=>r.put("/core/space/".concat(e,"/capabilities/").concat(t),a),es=async(e,t)=>r.delete("/core/space/".concat(e,"/capabilities/").concat(t)),en=async(e,t,a,s)=>r.get("/core/space/".concat(e,"/users"),{params:{...void 0!==t&&{space_id:t},...void 0!==a&&{user_id:a},...s&&{scope:s}}}),er=async(e,t)=>r.post("/core/space/".concat(e,"/users"),t),ec=async(e,t,a)=>r.put("/core/space/".concat(e,"/users/").concat(t),a),eo=async(e,t)=>r.delete("/core/space/".concat(e,"/users/").concat(t)),ei=async(e,t,a)=>r.get("/core/space/".concat(e,"/events"),{params:{...void 0!==t&&{space_id:t},...a&&{event_key:a}}}),el=async(e,t)=>r.get("/core/space/".concat(e,"/events/").concat(t)),ed=async(e,t)=>{let a={event_key:t.event_key,target_type:t.target_type,...void 0!==t.space_id&&{space_id:t.space_id},...t.target_endpoint&&{target_endpoint:t.target_endpoint},...t.target_options&&{target_options:"string"==typeof t.target_options?t.target_options:JSON.stringify(t.target_options)},...t.target_code&&{target_code:t.target_code},...t.rules&&{rules:"string"==typeof t.rules?t.rules:JSON.stringify(t.rules)},...t.transform&&{transform:"string"==typeof t.transform?t.transform:JSON.stringify(t.transform)},...t.extrameta&&{extrameta:"string"==typeof t.extrameta?t.extrameta:JSON.stringify(t.extrameta)},...void 0!==t.disabled&&{disabled:t.disabled}};return r.post("/core/space/".concat(e,"/events"),a)},ep=async(e,t,a)=>{let s={};return void 0!==a.event_key&&(s.event_key=a.event_key),void 0!==a.target_type&&(s.target_type=a.target_type),void 0!==a.space_id&&(s.space_id=a.space_id),void 0!==a.target_endpoint&&(s.target_endpoint=a.target_endpoint),void 0!==a.target_options&&(s.target_options="string"==typeof a.target_options?a.target_options:JSON.stringify(a.target_options)),void 0!==a.target_code&&(s.target_code=a.target_code),void 0!==a.rules&&(s.rules="string"==typeof a.rules?a.rules:JSON.stringify(a.rules)),void 0!==a.transform&&(s.transform="string"==typeof a.transform?a.transform:JSON.stringify(a.transform)),void 0!==a.extrameta&&(s.extrameta="string"==typeof a.extrameta?a.extrameta:JSON.stringify(a.extrameta)),void 0!==a.disabled&&(s.disabled=a.disabled),r.put("/core/space/".concat(e,"/events/").concat(t),s)},eu=async(e,t)=>r.delete("/core/space/".concat(e,"/events/").concat(t)),eg=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,a={limit:t};return null!=e&&(a.after_id=e),r.get("/core/user/messages",{params:a})},ef=async()=>r.get("/core/user/messages/new"),ey=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return r.get("/core/user/messages/history",{params:{limit:e}})},em=async e=>r.delete("/core/user/messages/".concat(e)),eh=async e=>r.post("/core/user/messages/".concat(e,"/read")),ex=async()=>r.post("/core/user/messages/read-all")},3999:(e,t,a)=>{"use strict";a.d(t,{MH:()=>r,NC:()=>n,a1:()=>c});let s="_tnx_login_info_",n=(e,t)=>{localStorage.setItem(s,JSON.stringify({accessToken:e,userInfo:t}))},r=()=>{let e=localStorage.getItem(s);return e?JSON.parse(e):null},c=()=>{localStorage.removeItem(s)}},4678:(e,t,a)=>{"use strict";a.d(t,{$V:()=>n.$V,AC:()=>n.AC,B9:()=>n.B9,Cs:()=>n.Cs,De:()=>n.De,Ed:()=>n.Ed,H1:()=>n.H1,H4:()=>n.H4,K4:()=>n.K4,Kh:()=>n.Kh,Lv:()=>n.Lv,MA:()=>n.MA,MH:()=>s.MH,NC:()=>s.NC,Nv:()=>n.Nv,Om:()=>n.Om,P6:()=>n.P6,Pj:()=>n.Pj,QT:()=>n.QT,Qf:()=>n.Qf,Qk:()=>n.Qk,R5:()=>n.R5,Sx:()=>n.Sx,T:()=>n.T,TT:()=>n.TT,TY:()=>n.TY,Tv:()=>n.Tv,U8:()=>n.U8,VG:()=>n.VG,Y3:()=>n.Y3,ZN:()=>n.ZN,_m:()=>n._m,a1:()=>s.a1,ct:()=>n.ct,e0:()=>n.e0,eK:()=>n.eK,fB:()=>n.fB,iY:()=>n.iY,lB:()=>n.lB,lo:()=>n.lo,q0:()=>n.q0,qf:()=>n.qf,rf:()=>n.rf,s2:()=>n.s2,tF:()=>n.tF,to:()=>n.to,u1:()=>n.u1,uP:()=>n.uP,yn:()=>n.yn,z6:()=>n.z6});var s=a(3999),n=a(1886)},4968:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var s=a(5155),n=a(4678),r=a(5695),c=a(2115);function o(){return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"flex flex-col items-center justify-center h-screen",children:(0,s.jsx)(i,{})})})}let i=()=>{let[e,t]=(0,c.useState)(null),[a,o]=(0,c.useState)("loading"),[i,p]=(0,c.useState)(null),[u,g]=(0,c.useState)(null),[f,y]=(0,c.useState)(!1),[m,h]=(0,c.useState)(null),x=(0,r.useSearchParams)();(0,c.useEffect)(()=>{(async()=>{o("loading"),p(null);let e=x.get("redirect_back_url");if(!e){p("redirect_back_url is not set"),o("error");return}let a=new URL(e);if(!a.pathname.startsWith("/zz/space/")){p("redirect_back_url is not a valid redirect_back_url"),o("error");return}let s=new URL(e).pathname.split("/").pop();if(!s){p("extract space_key failed"),o("error");return}try{let e=await (0,n.De)(s,a.hostname);200===e.status?(t(e.data),o("space_info_loaded")):(p("failed to get space info"),o("error"))}catch(e){console.error(e),p("failed to get space info: "+e),o("error")}})()},[x]),(0,c.useEffect)(()=>{(()=>{let e=(0,n.MH)();(null==e?void 0:e.userInfo)?(g(e.userInfo),y(!0)):y(!1)})()},[]);let _=()=>{let e=x.get("redirect_back_url");if(!e)return void console.log("@redirect_back_url is not set");let t=new URL(e);t.searchParams.set("deny_space_token","true"),window.location.href=t.toString()},v=()=>{let e=x.get("redirect_back_url");if(!e)return void console.log("@redirect_back_url is not set");window.sessionStorage.setItem("redirect_back_url",e);let t=new URL("/zz/pages/auth/login",window.location.origin),a=new URL("/zz/pages/auth/space/in_host",window.location.origin);a.searchParams.set("redirect_back_url",e),t.searchParams.set("after_login_redirect_back_url",a.toString()),window.location.href=t.toString()},b=async()=>{if(!e){p("spaceInfo is not set"),o("error");return}try{o("loading");let t=await (0,n.u1)(e.namespace_key,e.id);200===t.status?(h(t.data.token),o("space_token_loaded")):(p("failed to authorize space"),o("error"))}catch(e){console.error(e),p("failed to authorize space: "+e),o("error")}};return(0,s.jsxs)(s.Fragment,{children:["loading"===a&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{children:"Loading..."})}),"error"===a&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{children:["Error: ",i]})}),"space_info_loaded"===a&&(0,s.jsxs)(s.Fragment,{children:[!f&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(d,{onLogin:v,onDeny:_})}),f&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(l,{spaceInfo:e,onAuthorize:()=>{b()},onDeny:_,onChangeAccount:v,loggedInUser:null==u?void 0:u.name})})]}),"space_token_loaded"===a&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[500px] bg-gray-100 dark:bg-gray-900 p-4",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-md flex flex-col gap-4",children:[(0,s.jsx)("div",{className:"flex mb-6 space-x-4 items-center justify-center",children:(0,s.jsx)("img",{src:"/zz/pages/logo.png",alt:"Turnix Logo",className:"w-10 h-10"})}),(0,s.jsx)("h6",{className:"h4 text-base",children:"Authorized successfully"}),(0,s.jsx)("div",{className:"flex justify-center items-center",children:(0,s.jsx)("button",{onClick:()=>{let t=x.get("redirect_back_url");if(!t)return void console.log("@redirect_back_url is not set");let a=new URL("/zz/pages/auth/space/in_space/post_page",t);a.searchParams.set("redirect_back_url",t),a.searchParams.set("space_token",m),a.searchParams.set("nskey",e.namespace_key),window.location.href=a.toString()},children:"Redirect to space"})})]})})})]})},l=e=>(0,s.jsx)("div",{className:"flex items-center justify-center h-[500px] bg-gray-100 dark:bg-gray-900 p-4",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-md flex flex-col gap-4",children:[(0,s.jsx)("div",{className:"flex mb-6 space-x-4 items-center justify-center",children:(0,s.jsx)("img",{src:"/zz/pages/logo.png",alt:"Turnix Logo",className:"w-10 h-10"})}),(0,s.jsx)("h6",{className:"h4 text-base",children:"Do you want to authorize this space?"}),(0,s.jsx)("div",{className:"flex justify-center items-center",children:(0,s.jsx)("span",{className:"font-light rounded-md bg-gray-100 p-2",children:e.spaceInfo.package_name})}),(0,s.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,s.jsx)("button",{onClick:e.onAuthorize,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out",children:"Authorize"}),(0,s.jsx)("button",{onClick:e.onDeny,className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition duration-150 ease-in-out dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600",children:"Deny"})]}),(0,s.jsxs)("p",{className:"text-center text-sm text-gray-500 dark:text-gray-400",children:["Logged in as ",(0,s.jsx)("span",{className:"font-medium",children:e.loggedInUser}),"."," ",(0,s.jsx)("button",{onClick:e.onChangeAccount,className:"text-blue-600 hover:underline dark:text-blue-400",children:"Change account"})]})]})}),d=e=>(0,s.jsx)("div",{className:"flex items-center justify-center h-[500px] bg-gray-100 dark:bg-gray-900 p-4",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-md flex flex-col gap-4",children:[(0,s.jsx)("div",{className:"flex mb-6 space-x-4 items-center justify-center",children:(0,s.jsx)("img",{src:"/zz/pages/logo.png",alt:"Turnix Logo",className:"w-10 h-10"})}),(0,s.jsx)("h6",{className:"h4 text-base",children:"You are not logged in, Please login first to authorize this space."}),(0,s.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,s.jsx)("button",{onClick:e.onLogin,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out",children:"Login"}),(0,s.jsx)("button",{onClick:e.onDeny,className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition duration-150 ease-in-out dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600",children:"Deny"})]})]})})},5695:(e,t,a)=>{"use strict";var s=a(8999);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})}},e=>{e.O(0,[3464,8441,5964,7358],()=>e(e.s=670)),_N_E=e.O()}]);