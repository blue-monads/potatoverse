(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[293],{670:(e,t,a)=>{Promise.resolve().then(a.bind(a,4968))},1886:(e,t,a)=>{"use strict";a.d(t,{$V:()=>C,$c:()=>d,BA:()=>x,De:()=>T,Ed:()=>w,IF:()=>k,K4:()=>y,Lv:()=>Q,MA:()=>A,Oz:()=>u,Pj:()=>O,QD:()=>g,QT:()=>q,Qf:()=>U,Ql:()=>h,Sx:()=>Y,Tv:()=>F,U8:()=>I,Y3:()=>c,ZN:()=>B,_m:()=>m,ct:()=>M,e0:()=>P,eK:()=>K,eq:()=>p,fB:()=>z,iD:()=>o,iJ:()=>b,iQ:()=>v,iY:()=>R,ir:()=>f,iu:()=>j,j3:()=>_,lB:()=>E,lo:()=>i,q0:()=>H,s2:()=>S,tF:()=>N,u1:()=>D,wz:()=>l,yn:()=>L});var n=a(3464),s=a(3999);let r=n.A.create({baseURL:"/zz/api"}),c=()=>{let e=(0,s.MH)(),t={"Content-Type":"application/json","X-Overhead":"Aaron Swartz"};(null==e?void 0:e.accessToken)&&(t.Authorization="TokenV1 ".concat(e.accessToken)),r=n.A.create({baseURL:"/zz/api",headers:t})},o=async(e,t)=>r.post("/core/auth/login",{username:e,password:t}),i=async()=>r.get("/core/user"),l=async e=>r.get("/core/user/".concat(e)),u=async()=>r.get("/core/user/invites"),d=async e=>r.post("/core/user/invites",e),g=async e=>r.delete("/core/user/invites/".concat(e)),p=async e=>r.post("/core/user/invites/".concat(e,"/resend")),f=async e=>r.get("/core/auth/invite/".concat(e)),h=async(e,t)=>r.post("/core/auth/invite/".concat(e),t),m=async e=>r.post("/core/user/create",e),y=async()=>r.get("/core/user/groups"),x=async e=>r.post("/core/user/groups",e),b=async(e,t)=>r.put("/core/user/groups/".concat(e),t),k=async e=>r.delete("/core/user/groups/".concat(e)),v=async e=>r.get("/core/self/portalData/".concat(e)),_=async()=>r.get("/core/self/info"),j=async e=>r.put("/core/self/bio",{bio:e}),w=async e=>r.post("/core/package/install",{url:e}),N=async e=>r.post("/core/package/install/zip",e,{headers:{"Content-Type":"application/zip"}}),z=async e=>r.post("/core/package/install/embed",{name:e}),S=async e=>r.delete("/core/package/".concat(e)),C=async()=>r.get("/core/package/list"),L=async()=>r.get("/core/space/installed"),T=async e=>r.get("/core/engine/space_info/".concat(e)),D=async(e,t)=>r.post("/core/space/authorize/".concat(e),{space_id:t}),A=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return r.get("/core/package/".concat(e,"/files"),{params:{path:t}})},F=async(e,t)=>r.get("/core/package/".concat(e,"/files/").concat(t,"/download"),{responseType:"blob"}),P=async(e,t)=>r.delete("/core/package/".concat(e,"/files/").concat(t)),I=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=new FormData;return n.append("file",t),n.append("path",a),r.post("/core/package/".concat(e,"/files/upload"),n,{headers:{"Content-Type":"multipart/form-data"}})},U=async e=>r.get("/core/space/".concat(e,"/kv")),R=async(e,t)=>r.post("/core/space/".concat(e,"/kv"),t),E=async(e,t,a)=>r.put("/core/space/".concat(e,"/kv/").concat(t),a),Q=async(e,t)=>r.delete("/core/space/".concat(e,"/kv/").concat(t)),M=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return r.get("/core/space/".concat(e,"/files"),{params:{path:t}})},B=async(e,t)=>r.get("/core/space/".concat(e,"/files/").concat(t,"/download"),{responseType:"blob"}),Y=async(e,t)=>r.delete("/core/space/".concat(e,"/files/").concat(t)),K=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=new FormData;return n.append("file",t),n.append("path",a),r.post("/core/space/".concat(e,"/files/upload"),n,{headers:{"Content-Type":"multipart/form-data"}})},O=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return r.post("/core/space/".concat(e,"/files/folder"),{name:t,path:a})},H=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3?arguments[3]:void 0;return r.post("/core/space/".concat(e,"/files/presigned"),{file_name:t,path:a,expiry:n})},q=async(e,t)=>{let a=new FormData;return a.append("file",t),n.A.post("/zz/file/upload-presigned?presigned-key=".concat(e),a,{headers:{"Content-Type":"multipart/form-data"}})}},3999:(e,t,a)=>{"use strict";a.d(t,{MH:()=>r,NC:()=>s,a1:()=>c});let n="_tnx_login_info_",s=(e,t)=>{localStorage.setItem(n,JSON.stringify({accessToken:e,userInfo:t}))},r=()=>{let e=localStorage.getItem(n);return e?JSON.parse(e):null},c=()=>{localStorage.removeItem(n)}},4678:(e,t,a)=>{"use strict";a.d(t,{$V:()=>s.$V,De:()=>s.De,Ed:()=>s.Ed,K4:()=>s.K4,Lv:()=>s.Lv,MA:()=>s.MA,MH:()=>n.MH,NC:()=>n.NC,Pj:()=>s.Pj,QT:()=>s.QT,Qf:()=>s.Qf,Sx:()=>s.Sx,Tv:()=>s.Tv,U8:()=>s.U8,Y3:()=>s.Y3,ZN:()=>s.ZN,_m:()=>s._m,a1:()=>n.a1,ct:()=>s.ct,e0:()=>s.e0,eK:()=>s.eK,fB:()=>s.fB,iY:()=>s.iY,lB:()=>s.lB,lo:()=>s.lo,q0:()=>s.q0,s2:()=>s.s2,tF:()=>s.tF,u1:()=>s.u1,yn:()=>s.yn});var n=a(3999),s=a(1886)},4968:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var n=a(5155),s=a(4678),r=a(5695),c=a(2115);function o(){return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"flex flex-col items-center justify-center h-screen",children:(0,n.jsx)(i,{})})})}let i=()=>{let[e,t]=(0,c.useState)(null),[a,o]=(0,c.useState)("loading"),[i,d]=(0,c.useState)(null),[g,p]=(0,c.useState)(null),[f,h]=(0,c.useState)(!1),[m,y]=(0,c.useState)(null),x=(0,r.useSearchParams)();(0,c.useEffect)(()=>{(async()=>{o("loading"),d(null);let e=x.get("redirect_back_url");if(!e){d("redirect_back_url is not set"),o("error");return}if(!new URL(e).pathname.startsWith("/zz/space/")){d("redirect_back_url is not a valid redirect_back_url"),o("error");return}let a=new URL(e).pathname.split("/").pop();if(!a){d("extract space_key failed"),o("error");return}try{let e=await (0,s.De)(a);200===e.status?(t(e.data),o("space_info_loaded")):(d("failed to get space info"),o("error"))}catch(e){console.error(e),d("failed to get space info: "+e),o("error")}})()},[x]),(0,c.useEffect)(()=>{(()=>{let e=(0,s.MH)();(null==e?void 0:e.userInfo)?(p(e.userInfo),h(!0)):h(!1)})()},[]);let b=()=>{let e=x.get("redirect_back_url");if(!e)return void console.log("@redirect_back_url is not set");let t=new URL(e);t.searchParams.set("deny_space_token","true"),window.location.href=t.toString()},k=()=>{let e=x.get("redirect_back_url");if(!e)return void console.log("@redirect_back_url is not set");window.sessionStorage.setItem("redirect_back_url",e);let t=new URL("/zz/pages/auth/login",window.location.origin),a=new URL("/zz/pages/auth/space/in_host",window.location.origin);a.searchParams.set("redirect_back_url",e),t.searchParams.set("after_login_redirect_back_url",a.toString()),window.location.href=t.toString()},v=async()=>{if(!e){d("spaceInfo is not set"),o("error");return}try{o("loading");let t=await (0,s.u1)(e.namespace_key,e.id);200===t.status?(y(t.data.token),localStorage.setItem("".concat(e.namespace_key,"_space_token"),t.data.token),o("space_token_loaded")):(d("failed to authorize space"),o("error"))}catch(e){console.error(e),d("failed to authorize space: "+e),o("error")}};return(0,n.jsxs)(n.Fragment,{children:["loading"===a&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{children:"Loading..."})}),"error"===a&&(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{children:["Error: ",i]})}),"space_info_loaded"===a&&(0,n.jsxs)(n.Fragment,{children:[!f&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(u,{onLogin:k,onDeny:b})}),f&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(l,{spaceInfo:e,onAuthorize:()=>{v()},onDeny:b,onChangeAccount:k,loggedInUser:null==g?void 0:g.name})})]}),"space_token_loaded"===a&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-100 dark:bg-gray-900 p-4",children:(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-md flex flex-col gap-4",children:[(0,n.jsx)("div",{className:"flex mb-6 space-x-4 items-center justify-center",children:(0,n.jsx)("img",{src:"/zz/pages/logo.png",alt:"Turnix Logo",className:"w-10 h-10"})}),(0,n.jsx)("h6",{className:"h4 text-base",children:"Authorized successfully"}),(0,n.jsx)("div",{className:"flex justify-center items-center",children:(0,n.jsx)("button",{onClick:()=>{let e=x.get("redirect_back_url");if(!e)return void console.log("@redirect_back_url is not set");let t=new URL(e);window.location.href=t.toString()},children:"Redirect to space"})})]})})})]})},l=e=>(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-100 dark:bg-gray-900 p-4",children:(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-md flex flex-col gap-4",children:[(0,n.jsx)("div",{className:"flex mb-6 space-x-4 items-center justify-center",children:(0,n.jsx)("img",{src:"/zz/pages/logo.png",alt:"Turnix Logo",className:"w-10 h-10"})}),(0,n.jsx)("h6",{className:"h4 text-base",children:"Do you want to authorize this space?"}),(0,n.jsx)("div",{className:"flex justify-center items-center",children:(0,n.jsx)("span",{className:"font-light rounded-md bg-gray-100 p-2",children:e.spaceInfo.package_name})}),(0,n.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,n.jsx)("button",{onClick:e.onAuthorize,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out",children:"Authorize"}),(0,n.jsx)("button",{onClick:e.onDeny,className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition duration-150 ease-in-out dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600",children:"Deny"})]}),(0,n.jsxs)("p",{className:"text-center text-sm text-gray-500 dark:text-gray-400",children:["Logged in as ",(0,n.jsx)("span",{className:"font-medium",children:e.loggedInUser}),"."," ",(0,n.jsx)("button",{onClick:e.onChangeAccount,className:"text-blue-600 hover:underline dark:text-blue-400",children:"Change account"})]})]})}),u=e=>(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-100 dark:bg-gray-900 p-4",children:(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-md flex flex-col gap-4",children:[(0,n.jsx)("div",{className:"flex mb-6 space-x-4 items-center justify-center",children:(0,n.jsx)("img",{src:"/zz/pages/logo.png",alt:"Turnix Logo",className:"w-10 h-10"})}),(0,n.jsx)("h6",{className:"h4 text-base",children:"You are not logged in, Please login first to authorize this space."}),(0,n.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,n.jsx)("button",{onClick:e.onLogin,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out",children:"Login"}),(0,n.jsx)("button",{onClick:e.onDeny,className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition duration-150 ease-in-out dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600",children:"Deny"})]})]})})},5695:(e,t,a)=>{"use strict";var n=a(8999);a.o(n,"usePathname")&&a.d(t,{usePathname:function(){return n.usePathname}}),a.o(n,"useRouter")&&a.d(t,{useRouter:function(){return n.useRouter}}),a.o(n,"useSearchParams")&&a.d(t,{useSearchParams:function(){return n.useSearchParams}})}},e=>{e.O(0,[464,441,964,977],()=>e(e.s=670)),_N_E=e.O()}]);