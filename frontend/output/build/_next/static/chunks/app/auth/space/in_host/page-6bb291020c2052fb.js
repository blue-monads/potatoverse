(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8293],{670:(e,t,s)=>{Promise.resolve().then(s.bind(s,4968))},4678:(e,t,s)=>{"use strict";s.d(t,{$V:()=>r.$V,AC:()=>r.AC,B9:()=>r.B9,Cs:()=>r.Cs,De:()=>r.De,Ed:()=>r.Ed,H1:()=>r.H1,H4:()=>r.H4,K4:()=>r.K4,Kh:()=>r.Kh,Lv:()=>r.Lv,MA:()=>r.MA,MH:()=>a.MH,NC:()=>a.NC,Nv:()=>r.Nv,Om:()=>r.Om,P6:()=>r.P6,Pj:()=>r.Pj,QT:()=>r.QT,Qf:()=>r.Qf,Qk:()=>r.Qk,R5:()=>r.R5,Sx:()=>r.Sx,T:()=>r.T,TT:()=>r.TT,TY:()=>r.TY,Tv:()=>r.Tv,U8:()=>r.U8,VG:()=>r.VG,Y3:()=>r.Y3,ZN:()=>r.ZN,_Q:()=>r._Q,_m:()=>r._m,a1:()=>a.a1,cZ:()=>r.cZ,ct:()=>r.ct,e0:()=>r.e0,eK:()=>r.eK,fB:()=>r.fB,iY:()=>r.iY,lB:()=>r.lB,lo:()=>r.lo,q0:()=>r.q0,qf:()=>r.qf,rf:()=>r.rf,s2:()=>r.s2,tF:()=>r.tF,to:()=>r.to,u1:()=>r.u1,uP:()=>r.uP,yn:()=>r.yn,z6:()=>r.z6});var a=s(3999),r=s(1886)},4968:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var a=s(5155),r=s(4678),n=s(5695),o=s(2115);function c(){return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"flex flex-col items-center justify-center h-screen",children:(0,a.jsx)(i,{})})})}let i=()=>{let[e,t]=(0,o.useState)(null),[s,c]=(0,o.useState)("loading"),[i,d]=(0,o.useState)(null),[g,h]=(0,o.useState)(null),[f,m]=(0,o.useState)(!1),[x,p]=(0,o.useState)(null),_=(0,n.useSearchParams)();(0,o.useEffect)(()=>{(async()=>{c("loading"),d(null);let e=_.get("redirect_back_url");if(!e){d("redirect_back_url is not set"),c("error");return}let s=new URL(e);if(!s.pathname.startsWith("/zz/space/")){d("redirect_back_url is not a valid redirect_back_url"),c("error");return}let a=new URL(e).pathname.split("/").pop();if(!a){d("extract space_key failed"),c("error");return}try{let e=await (0,r.De)(a,s.hostname);200===e.status?(t(e.data),c("space_info_loaded")):(d("failed to get space info"),c("error"))}catch(e){console.error(e),d("failed to get space info: "+e),c("error")}})()},[_]),(0,o.useEffect)(()=>{(()=>{let e=(0,r.MH)();(null==e?void 0:e.userInfo)?(h(e.userInfo),m(!0)):m(!1)})()},[]);let b=()=>{console.log("@redirectWithoutSpaceToken",_.toString());let e=_.get("redirect_back_url");if(!e)return void console.log("@redirect_back_url is not set");let t=_.get("actual_page"),s=new URL(e);t&&s.searchParams.set("actual_page",t),s.searchParams.set("deny_space_token","true"),window.location.href=s.toString()},j=()=>{console.log("@redirrectToLoginPage",_.toString());let e=_.get("redirect_back_url");if(!e)return void console.log("@redirect_back_url is not set");let t=_.get("actual_page");window.sessionStorage.setItem("redirect_back_url",e);let s=new URL("/zz/pages/auth/login",window.location.origin),a=new URL("/zz/pages/auth/space/in_host",window.location.origin);a.searchParams.set("redirect_back_url",e),t&&a.searchParams.set("actual_page",t),console.log("@finalRedirectBackUrl",a.toString()),s.searchParams.set("after_login_redirect_back_url",a.toString()),window.location.href=s.toString()},y=async()=>{if(!e){d("spaceInfo is not set"),c("error");return}try{c("loading");let t=await (0,r.u1)(e.namespace_key,e.id);200===t.status?(p(t.data.token),c("space_token_loaded")):(d("failed to authorize space"),c("error"))}catch(e){console.error(e),d("failed to authorize space: "+e),c("error")}};return(0,a.jsxs)(a.Fragment,{children:["loading"===s&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{children:"Loading..."})}),"error"===s&&(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{children:["Error: ",i]})}),"space_info_loaded"===s&&(0,a.jsxs)(a.Fragment,{children:[!f&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(u,{onLogin:j,onDeny:b})}),f&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(l,{spaceInfo:e,onAuthorize:()=>{y()},onDeny:b,onChangeAccount:j,loggedInUser:null==g?void 0:g.name})})]}),"space_token_loaded"===s&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[500px] bg-gray-100 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-8 w-full max-w-md flex flex-col gap-4",children:[(0,a.jsx)("div",{className:"flex mb-6 space-x-4 items-center justify-center",children:(0,a.jsx)("img",{src:"/zz/pages/logo.png",alt:"Potatoverse Logo",className:"w-10 h-10"})}),(0,a.jsx)("h6",{className:"h4 text-base",children:"Authorized successfully"}),(0,a.jsx)("div",{className:"flex justify-center items-center",children:(0,a.jsx)("button",{onClick:()=>{console.log("@in_host/post_page",_.toString());let t=_.get("redirect_back_url");if(!t)return void console.log("@redirect_back_url is not set");let s=_.get("actual_page"),a=new URL("/zz/pages/auth/space/in_space/post_page",t);a.searchParams.set("redirect_back_url",t),a.searchParams.set("space_token",x),a.searchParams.set("nskey",e.namespace_key),s&&a.searchParams.set("actual_page",s),window.location.href=a.toString()},children:"Redirect to space"})})]})})})]})},l=e=>(0,a.jsx)("div",{className:"flex items-center justify-center h-[500px] bg-gray-100 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-8 w-full max-w-md flex flex-col gap-4",children:[(0,a.jsx)("div",{className:"flex mb-6 space-x-4 items-center justify-center",children:(0,a.jsx)("img",{src:"/zz/pages/logo.png",alt:"Potatoverse Logo",className:"w-10 h-10"})}),(0,a.jsx)("h6",{className:"h4 text-base",children:"Do you want to authorize this space?"}),(0,a.jsx)("div",{className:"flex justify-center items-center",children:(0,a.jsx)("span",{className:"font-light rounded-md bg-gray-100 p-2",children:e.spaceInfo.package_name})}),(0,a.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,a.jsx)("button",{onClick:e.onAuthorize,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out",children:"Authorize"}),(0,a.jsx)("button",{onClick:e.onDeny,className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition duration-150 ease-in-out",children:"Deny"})]}),(0,a.jsxs)("p",{className:"text-center text-sm text-gray-500",children:["Logged in as ",(0,a.jsx)("span",{className:"font-medium",children:e.loggedInUser}),"."," ",(0,a.jsx)("button",{onClick:e.onChangeAccount,className:"text-blue-600 hover:underline",children:"Change account"})]})]})}),u=e=>(0,a.jsx)("div",{className:"flex items-center justify-center h-[500px] bg-gray-100 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-8 w-full max-w-md flex flex-col gap-4",children:[(0,a.jsx)("div",{className:"flex mb-6 space-x-4 items-center justify-center",children:(0,a.jsx)("img",{src:"/zz/pages/logo.png",alt:"Potatoverse Logo",className:"w-10 h-10"})}),(0,a.jsx)("h6",{className:"h4 text-base",children:"You are not logged in, Please login first to authorize this space."}),(0,a.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,a.jsx)("button",{onClick:e.onLogin,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out",children:"Login"}),(0,a.jsx)("button",{onClick:e.onDeny,className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition duration-150 ease-in-out",children:"Deny"})]})]})})},5695:(e,t,s)=>{"use strict";var a=s(8999);s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})}},e=>{e.O(0,[3464,1886,8441,5964,7358],()=>e(e.s=670)),_N_E=e.O()}]);