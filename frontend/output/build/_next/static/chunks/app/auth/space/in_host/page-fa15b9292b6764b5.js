(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8293],{670:(e,t,a)=>{Promise.resolve().then(a.bind(a,4968))},1886:(e,t,a)=>{"use strict";a.d(t,{$V:()=>P,$c:()=>p,AC:()=>T,B9:()=>B,BA:()=>_,Cs:()=>ee,De:()=>F,Ed:()=>j,H1:()=>ed,H4:()=>eg,IF:()=>x,K4:()=>h,Kh:()=>ep,Ku:()=>ej,Lv:()=>E,MA:()=>O,Nv:()=>ec,Om:()=>es,Oz:()=>d,P6:()=>el,Pj:()=>Z,QD:()=>u,QT:()=>X,Qf:()=>H,Qk:()=>en,Ql:()=>f,R5:()=>J,Sx:()=>V,T:()=>ea,TT:()=>G,TY:()=>et,Tv:()=>U,U8:()=>Q,UP:()=>eb,VG:()=>D,Y3:()=>r,YT:()=>R,ZN:()=>M,_Q:()=>ew,_m:()=>m,ct:()=>q,dv:()=>eh,e0:()=>I,eK:()=>$,eq:()=>g,fB:()=>z,gw:()=>ev,iD:()=>o,iJ:()=>v,iQ:()=>b,iY:()=>Y,ir:()=>y,iu:()=>w,j3:()=>k,lB:()=>K,lo:()=>i,mm:()=>e_,no:()=>ef,q0:()=>W,qR:()=>ex,qf:()=>er,rf:()=>eu,s2:()=>S,sI:()=>em,si:()=>ek,tF:()=>N,to:()=>eo,u1:()=>A,uP:()=>C,wz:()=>l,yj:()=>ey,yn:()=>L,z6:()=>ei});var s=a(3464),n=a(3999);let c=s.A.create({baseURL:"/zz/api"}),r=()=>{let e=(0,n.MH)(),t={"Content-Type":"application/json","X-Clacks-Overhead":"Aaron Swartz"};(null==e?void 0:e.accessToken)&&(t.Authorization="TokenV1 ".concat(e.accessToken)),c=s.A.create({baseURL:"/zz/api",headers:t})},o=async(e,t)=>c.post("/core/auth/login",{username:e,password:t}),i=async()=>c.get("/core/user"),l=async e=>c.get("/core/user/".concat(e)),d=async()=>c.get("/core/user/invites"),p=async e=>c.post("/core/user/invites",e),u=async e=>c.delete("/core/user/invites/".concat(e)),g=async e=>c.post("/core/user/invites/".concat(e,"/resend")),y=async e=>c.get("/core/auth/invite/".concat(e)),f=async(e,t)=>c.post("/core/auth/invite/".concat(e),t),m=async e=>c.post("/core/user/create",e),h=async()=>c.get("/core/user/groups"),_=async e=>c.post("/core/user/groups",e),v=async(e,t)=>c.put("/core/user/groups/".concat(e),t),x=async e=>c.delete("/core/user/groups/".concat(e)),b=async e=>c.get("/core/self/portalData/".concat(e)),k=async()=>c.get("/core/self/info"),w=async e=>c.put("/core/self/bio",{bio:e}),j=async e=>c.post("/core/package/install",{url:e}),N=async e=>c.post("/core/package/install/zip",e,{headers:{"Content-Type":"application/zip"}}),z=async(e,t)=>c.post("/core/package/install/embed",{name:e,repo_slug:t}),S=async e=>c.delete("/core/package/".concat(e)),T=async e=>c.post("/core/package/".concat(e,"/dev-token")),P=async e=>{let t=e?"?repo=".concat(encodeURIComponent(e)):"";return c.get("/core/package/list".concat(t))},C=async()=>c.get("/core/repo/list"),L=async()=>c.get("/core/space/installed"),D=async e=>c.get("/core/package/".concat(e,"/info")),F=async(e,t)=>{let a=encodeURIComponent(t);return c.get("/core/engine/space_info/".concat(e,"?host_name=").concat(a.toString()))},R=async(e,t)=>{let a=window.location.hostname;return c.get("/core/engine/derivehost/".concat(e,"?host_name=").concat(a,"&space_id=").concat(t))},A=async(e,t)=>c.post("/core/space/authorize/".concat(e),{space_id:t}),O=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return c.get("/core/vpackage/".concat(e,"/files"),{params:{path:t}})},U=async(e,t)=>c.get("/core/vpackage/".concat(e,"/files/").concat(t,"/download"),{responseType:"blob"}),I=async(e,t)=>c.delete("/core/vpackage/".concat(e,"/files/").concat(t)),Q=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=new FormData;return s.append("file",t),s.append("path",a),c.post("/core/vpackage/".concat(e,"/files/upload"),s,{headers:{"Content-Type":"multipart/form-data"}})},B=async function(e,t,a,s){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";await I(e,t);let r=new File([new Blob([a],{type:"text/plain"})],s,{type:"text/plain"}),o=new FormData;return o.append("file",r),o.append("path",n),c.post("/core/vpackage/".concat(e,"/files/upload"),o,{headers:{"Content-Type":"multipart/form-data"}})},H=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return c.get("/core/space/".concat(e,"/kv"),{params:{offset:t,limit:a}})},J=async(e,t)=>c.get("/core/space/".concat(e,"/kv/").concat(t)),Y=async(e,t)=>c.post("/core/space/".concat(e,"/kv"),t),K=async(e,t,a)=>c.put("/core/space/".concat(e,"/kv/").concat(t),a),E=async(e,t)=>c.delete("/core/space/".concat(e,"/kv/").concat(t)),q=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return c.get("/core/space/".concat(e,"/files"),{params:{path:t}})},M=async(e,t)=>c.get("/core/space/".concat(e,"/files/").concat(t,"/download"),{responseType:"blob"}),V=async(e,t)=>c.delete("/core/space/".concat(e,"/files/").concat(t)),$=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=new FormData;return s.append("file",t),s.append("path",a),c.post("/core/space/".concat(e,"/files/upload"),s,{headers:{"Content-Type":"multipart/form-data"}})},G=async function(e,t,a,s){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";await V(e,t);let r=new File([new Blob([a],{type:"text/plain"})],s,{type:"text/plain"}),o=new FormData;return o.append("file",r),o.append("path",n),c.post("/core/space/".concat(e,"/files/upload"),o,{headers:{"Content-Type":"multipart/form-data"}})},Z=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return c.post("/core/space/".concat(e,"/files/folder"),{name:t,path:a})},W=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments.length>3?arguments[3]:void 0;return c.post("/core/space/".concat(e,"/files/presigned"),{file_name:t,path:a,expiry:s})},X=async(e,t)=>{let a=new FormData;return a.append("file",t),s.A.post("/zz/file/upload-presigned?presigned-key=".concat(e),a,{headers:{"Content-Type":"multipart/form-data"}})},ee=async()=>c.get("/core/capability/types"),et=async(e,t,a)=>c.get("/core/space/".concat(e,"/capabilities"),{params:{...void 0!==t&&{space_id:t},...a&&{capability_type:a}}}),ea=async(e,t)=>c.post("/core/space/".concat(e,"/capabilities"),t),es=async(e,t,a)=>c.put("/core/space/".concat(e,"/capabilities/").concat(t),a),en=async(e,t)=>c.delete("/core/space/".concat(e,"/capabilities/").concat(t)),ec=async(e,t,a,s)=>c.get("/core/space/".concat(e,"/users"),{params:{...void 0!==t&&{space_id:t},...void 0!==a&&{user_id:a},...s&&{scope:s}}}),er=async(e,t)=>c.post("/core/space/".concat(e,"/users"),t),eo=async(e,t,a)=>c.put("/core/space/".concat(e,"/users/").concat(t),a),ei=async(e,t)=>c.delete("/core/space/".concat(e,"/users/").concat(t)),el=async(e,t,a)=>c.get("/core/space/".concat(e,"/events"),{params:{...void 0!==t&&{space_id:t},...a&&{event_key:a}}}),ed=async(e,t)=>c.get("/core/space/".concat(e,"/events/").concat(t)),ep=async(e,t)=>{let a={event_key:t.event_key,target_type:t.target_type,...void 0!==t.space_id&&{space_id:t.space_id},...t.target_endpoint&&{target_endpoint:t.target_endpoint},...t.target_options&&{target_options:"string"==typeof t.target_options?t.target_options:JSON.stringify(t.target_options)},...t.target_code&&{target_code:t.target_code},...void 0!==t.target_space_id&&{target_space_id:t.target_space_id},...t.rules&&{rules:"string"==typeof t.rules?t.rules:JSON.stringify(t.rules)},...t.transform&&{transform:"string"==typeof t.transform?t.transform:JSON.stringify(t.transform)},...void 0!==t.delay_start&&{delay_start:t.delay_start},...void 0!==t.retry_delay&&{retry_delay:t.retry_delay},...void 0!==t.max_retries&&{max_retries:t.max_retries},...t.extrameta&&{extrameta:"string"==typeof t.extrameta?t.extrameta:JSON.stringify(t.extrameta)},...void 0!==t.disabled&&{disabled:t.disabled}};return c.post("/core/space/".concat(e,"/events"),a)},eu=async(e,t,a)=>{let s={};return void 0!==a.event_key&&(s.event_key=a.event_key),void 0!==a.target_type&&(s.target_type=a.target_type),void 0!==a.space_id&&(s.space_id=a.space_id),void 0!==a.target_endpoint&&(s.target_endpoint=a.target_endpoint),void 0!==a.target_options&&(s.target_options="string"==typeof a.target_options?a.target_options:JSON.stringify(a.target_options)),void 0!==a.target_code&&(s.target_code=a.target_code),void 0!==a.rules&&(s.rules="string"==typeof a.rules?a.rules:JSON.stringify(a.rules)),void 0!==a.transform&&(s.transform="string"==typeof a.transform?a.transform:JSON.stringify(a.transform)),void 0!==a.delay_start&&(s.delay_start=a.delay_start),void 0!==a.retry_delay&&(s.retry_delay=a.retry_delay),void 0!==a.max_retries&&(s.max_retries=a.max_retries),void 0!==a.extrameta&&(s.extrameta="string"==typeof a.extrameta?a.extrameta:JSON.stringify(a.extrameta)),void 0!==a.disabled&&(s.disabled=a.disabled),c.put("/core/space/".concat(e,"/events/").concat(t),s)},eg=async(e,t)=>c.delete("/core/space/".concat(e,"/events/").concat(t)),ey=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,a={limit:t};return null!=e&&(a.after_id=e),c.get("/core/user/messages",{params:a})},ef=async()=>c.get("/core/user/messages/new"),em=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return c.get("/core/user/messages/history",{params:{limit:e}})},eh=async e=>c.post("/core/user/messages",e),e_=async e=>c.delete("/core/user/messages/".concat(e)),ev=async e=>c.post("/core/user/messages/".concat(e,"/read")),ex=async()=>c.post("/core/user/messages/read-all"),eb=async()=>c.get("/core/docs/docs_index.json"),ek=async e=>c.get("/core/docs/".concat(e)),ew=async e=>c.get("/capabilities/debug/".concat(e)),ej=async e=>c.get("/core/space/".concat(e,"/spec.json"))},3999:(e,t,a)=>{"use strict";a.d(t,{MH:()=>c,NC:()=>n,a1:()=>r});let s="_potato_login_info_",n=(e,t)=>{localStorage.setItem(s,JSON.stringify({accessToken:e,userInfo:t}))},c=()=>{let e=localStorage.getItem(s);return e?JSON.parse(e):null},r=()=>{localStorage.removeItem(s)}},4678:(e,t,a)=>{"use strict";a.d(t,{$V:()=>n.$V,AC:()=>n.AC,B9:()=>n.B9,Cs:()=>n.Cs,De:()=>n.De,Ed:()=>n.Ed,H1:()=>n.H1,H4:()=>n.H4,K4:()=>n.K4,Kh:()=>n.Kh,Lv:()=>n.Lv,MA:()=>n.MA,MH:()=>s.MH,NC:()=>s.NC,Nv:()=>n.Nv,Om:()=>n.Om,P6:()=>n.P6,Pj:()=>n.Pj,QT:()=>n.QT,Qf:()=>n.Qf,Qk:()=>n.Qk,R5:()=>n.R5,Sx:()=>n.Sx,T:()=>n.T,TT:()=>n.TT,TY:()=>n.TY,Tv:()=>n.Tv,U8:()=>n.U8,VG:()=>n.VG,Y3:()=>n.Y3,ZN:()=>n.ZN,_Q:()=>n._Q,_m:()=>n._m,a1:()=>s.a1,ct:()=>n.ct,e0:()=>n.e0,eK:()=>n.eK,fB:()=>n.fB,iY:()=>n.iY,lB:()=>n.lB,lo:()=>n.lo,q0:()=>n.q0,qf:()=>n.qf,rf:()=>n.rf,s2:()=>n.s2,tF:()=>n.tF,to:()=>n.to,u1:()=>n.u1,uP:()=>n.uP,yn:()=>n.yn,z6:()=>n.z6});var s=a(3999),n=a(1886)},4968:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var s=a(5155),n=a(4678),c=a(5695),r=a(2115);function o(){return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"flex flex-col items-center justify-center h-screen",children:(0,s.jsx)(i,{})})})}let i=()=>{let[e,t]=(0,r.useState)(null),[a,o]=(0,r.useState)("loading"),[i,p]=(0,r.useState)(null),[u,g]=(0,r.useState)(null),[y,f]=(0,r.useState)(!1),[m,h]=(0,r.useState)(null),_=(0,c.useSearchParams)();(0,r.useEffect)(()=>{(async()=>{o("loading"),p(null);let e=_.get("redirect_back_url");if(!e){p("redirect_back_url is not set"),o("error");return}let a=new URL(e);if(!a.pathname.startsWith("/zz/space/")){p("redirect_back_url is not a valid redirect_back_url"),o("error");return}let s=new URL(e).pathname.split("/").pop();if(!s){p("extract space_key failed"),o("error");return}try{let e=await (0,n.De)(s,a.hostname);200===e.status?(t(e.data),o("space_info_loaded")):(p("failed to get space info"),o("error"))}catch(e){console.error(e),p("failed to get space info: "+e),o("error")}})()},[_]),(0,r.useEffect)(()=>{(()=>{let e=(0,n.MH)();(null==e?void 0:e.userInfo)?(g(e.userInfo),f(!0)):f(!1)})()},[]);let v=()=>{console.log("@redirectWithoutSpaceToken",_.toString());let e=_.get("redirect_back_url");if(!e)return void console.log("@redirect_back_url is not set");let t=_.get("actual_page"),a=new URL(e);t&&a.searchParams.set("actual_page",t),a.searchParams.set("deny_space_token","true"),window.location.href=a.toString()},x=()=>{console.log("@redirrectToLoginPage",_.toString());let e=_.get("redirect_back_url");if(!e)return void console.log("@redirect_back_url is not set");let t=_.get("actual_page");window.sessionStorage.setItem("redirect_back_url",e);let a=new URL("/zz/pages/auth/login",window.location.origin),s=new URL("/zz/pages/auth/space/in_host",window.location.origin);s.searchParams.set("redirect_back_url",e),t&&s.searchParams.set("actual_page",t),console.log("@finalRedirectBackUrl",s.toString()),a.searchParams.set("after_login_redirect_back_url",s.toString()),window.location.href=a.toString()},b=async()=>{if(!e){p("spaceInfo is not set"),o("error");return}try{o("loading");let t=await (0,n.u1)(e.namespace_key,e.id);200===t.status?(h(t.data.token),o("space_token_loaded")):(p("failed to authorize space"),o("error"))}catch(e){console.error(e),p("failed to authorize space: "+e),o("error")}};return(0,s.jsxs)(s.Fragment,{children:["loading"===a&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{children:"Loading..."})}),"error"===a&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{children:["Error: ",i]})}),"space_info_loaded"===a&&(0,s.jsxs)(s.Fragment,{children:[!y&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(d,{onLogin:x,onDeny:v})}),y&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(l,{spaceInfo:e,onAuthorize:()=>{b()},onDeny:v,onChangeAccount:x,loggedInUser:null==u?void 0:u.name})})]}),"space_token_loaded"===a&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[500px] bg-gray-100 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-8 w-full max-w-md flex flex-col gap-4",children:[(0,s.jsx)("div",{className:"flex mb-6 space-x-4 items-center justify-center",children:(0,s.jsx)("img",{src:"/zz/pages/logo.png",alt:"Potatoverse Logo",className:"w-10 h-10"})}),(0,s.jsx)("h6",{className:"h4 text-base",children:"Authorized successfully"}),(0,s.jsx)("div",{className:"flex justify-center items-center",children:(0,s.jsx)("button",{onClick:()=>{console.log("@in_host/post_page",_.toString());let t=_.get("redirect_back_url");if(!t)return void console.log("@redirect_back_url is not set");let a=_.get("actual_page"),s=new URL("/zz/pages/auth/space/in_space/post_page",t);s.searchParams.set("redirect_back_url",t),s.searchParams.set("space_token",m),s.searchParams.set("nskey",e.namespace_key),a&&s.searchParams.set("actual_page",a),window.location.href=s.toString()},children:"Redirect to space"})})]})})})]})},l=e=>(0,s.jsx)("div",{className:"flex items-center justify-center h-[500px] bg-gray-100 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-8 w-full max-w-md flex flex-col gap-4",children:[(0,s.jsx)("div",{className:"flex mb-6 space-x-4 items-center justify-center",children:(0,s.jsx)("img",{src:"/zz/pages/logo.png",alt:"Potatoverse Logo",className:"w-10 h-10"})}),(0,s.jsx)("h6",{className:"h4 text-base",children:"Do you want to authorize this space?"}),(0,s.jsx)("div",{className:"flex justify-center items-center",children:(0,s.jsx)("span",{className:"font-light rounded-md bg-gray-100 p-2",children:e.spaceInfo.package_name})}),(0,s.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,s.jsx)("button",{onClick:e.onAuthorize,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out",children:"Authorize"}),(0,s.jsx)("button",{onClick:e.onDeny,className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition duration-150 ease-in-out",children:"Deny"})]}),(0,s.jsxs)("p",{className:"text-center text-sm text-gray-500",children:["Logged in as ",(0,s.jsx)("span",{className:"font-medium",children:e.loggedInUser}),"."," ",(0,s.jsx)("button",{onClick:e.onChangeAccount,className:"text-blue-600 hover:underline",children:"Change account"})]})]})}),d=e=>(0,s.jsx)("div",{className:"flex items-center justify-center h-[500px] bg-gray-100 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-8 w-full max-w-md flex flex-col gap-4",children:[(0,s.jsx)("div",{className:"flex mb-6 space-x-4 items-center justify-center",children:(0,s.jsx)("img",{src:"/zz/pages/logo.png",alt:"Potatoverse Logo",className:"w-10 h-10"})}),(0,s.jsx)("h6",{className:"h4 text-base",children:"You are not logged in, Please login first to authorize this space."}),(0,s.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,s.jsx)("button",{onClick:e.onLogin,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out",children:"Login"}),(0,s.jsx)("button",{onClick:e.onDeny,className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition duration-150 ease-in-out",children:"Deny"})]})]})})},5695:(e,t,a)=>{"use strict";var s=a(8999);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})}},e=>{e.O(0,[3464,8441,5964,7358],()=>e(e.s=670)),_N_E=e.O()}]);