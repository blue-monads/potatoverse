(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8293],{670:(e,t,a)=>{Promise.resolve().then(a.bind(a,4968))},1886:(e,t,a)=>{"use strict";a.d(t,{$V:()=>C,$c:()=>p,AC:()=>S,B9:()=>Q,BA:()=>_,Cs:()=>ee,De:()=>L,Ed:()=>j,H1:()=>ed,H4:()=>eu,IF:()=>v,K4:()=>h,Kh:()=>ep,Lv:()=>K,MA:()=>O,Nv:()=>en,Om:()=>es,Oz:()=>d,P6:()=>el,Pj:()=>Z,QD:()=>g,QT:()=>X,Qf:()=>H,Qk:()=>er,Ql:()=>f,R5:()=>J,Sx:()=>V,T:()=>ea,TT:()=>G,TY:()=>et,Tv:()=>U,U8:()=>B,UP:()=>ev,VG:()=>F,Y3:()=>c,YT:()=>A,ZN:()=>M,_m:()=>m,ct:()=>q,e0:()=>I,eK:()=>$,eq:()=>u,fB:()=>z,gw:()=>e_,iD:()=>o,iJ:()=>x,iQ:()=>b,iY:()=>Y,ir:()=>y,iu:()=>w,j3:()=>k,lB:()=>E,lo:()=>i,mm:()=>eh,no:()=>ef,q0:()=>W,qR:()=>ex,qf:()=>ec,rf:()=>eg,s2:()=>T,sI:()=>em,si:()=>eb,tF:()=>N,to:()=>eo,u1:()=>R,uP:()=>P,wz:()=>l,yj:()=>ey,yn:()=>D,z6:()=>ei});var s=a(3464),r=a(3999);let n=s.A.create({baseURL:"/zz/api"}),c=()=>{let e=(0,r.MH)(),t={"Content-Type":"application/json","X-Clacks-Overhead":"Aaron Swartz"};(null==e?void 0:e.accessToken)&&(t.Authorization="TokenV1 ".concat(e.accessToken)),n=s.A.create({baseURL:"/zz/api",headers:t})},o=async(e,t)=>n.post("/core/auth/login",{username:e,password:t}),i=async()=>n.get("/core/user"),l=async e=>n.get("/core/user/".concat(e)),d=async()=>n.get("/core/user/invites"),p=async e=>n.post("/core/user/invites",e),g=async e=>n.delete("/core/user/invites/".concat(e)),u=async e=>n.post("/core/user/invites/".concat(e,"/resend")),y=async e=>n.get("/core/auth/invite/".concat(e)),f=async(e,t)=>n.post("/core/auth/invite/".concat(e),t),m=async e=>n.post("/core/user/create",e),h=async()=>n.get("/core/user/groups"),_=async e=>n.post("/core/user/groups",e),x=async(e,t)=>n.put("/core/user/groups/".concat(e),t),v=async e=>n.delete("/core/user/groups/".concat(e)),b=async e=>n.get("/core/self/portalData/".concat(e)),k=async()=>n.get("/core/self/info"),w=async e=>n.put("/core/self/bio",{bio:e}),j=async e=>n.post("/core/package/install",{url:e}),N=async e=>n.post("/core/package/install/zip",e,{headers:{"Content-Type":"application/zip"}}),z=async(e,t)=>n.post("/core/package/install/embed",{name:e,repo_slug:t}),T=async e=>n.delete("/core/package/".concat(e)),S=async e=>n.post("/core/package/".concat(e,"/dev-token")),C=async e=>{let t=e?"?repo=".concat(encodeURIComponent(e)):"";return n.get("/core/package/list".concat(t))},P=async()=>n.get("/core/repo/list"),D=async()=>n.get("/core/space/installed"),F=async e=>n.get("/core/package/".concat(e,"/info")),L=async(e,t)=>{let a=encodeURIComponent(t);return n.get("/core/engine/space_info/".concat(e,"?host_name=").concat(a.toString()))},A=async(e,t)=>{let a=window.location.hostname;return n.get("/core/engine/derivehost/".concat(e,"?host_name=").concat(a,"&space_id=").concat(t))},R=async(e,t)=>n.post("/core/space/authorize/".concat(e),{space_id:t}),O=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return n.get("/core/vpackage/".concat(e,"/files"),{params:{path:t}})},U=async(e,t)=>n.get("/core/vpackage/".concat(e,"/files/").concat(t,"/download"),{responseType:"blob"}),I=async(e,t)=>n.delete("/core/vpackage/".concat(e,"/files/").concat(t)),B=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=new FormData;return s.append("file",t),s.append("path",a),n.post("/core/vpackage/".concat(e,"/files/upload"),s,{headers:{"Content-Type":"multipart/form-data"}})},Q=async function(e,t,a,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";await I(e,t);let c=new File([new Blob([a],{type:"text/plain"})],s,{type:"text/plain"}),o=new FormData;return o.append("file",c),o.append("path",r),n.post("/core/vpackage/".concat(e,"/files/upload"),o,{headers:{"Content-Type":"multipart/form-data"}})},H=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return n.get("/core/space/".concat(e,"/kv"),{params:{offset:t,limit:a}})},J=async(e,t)=>n.get("/core/space/".concat(e,"/kv/").concat(t)),Y=async(e,t)=>n.post("/core/space/".concat(e,"/kv"),t),E=async(e,t,a)=>n.put("/core/space/".concat(e,"/kv/").concat(t),a),K=async(e,t)=>n.delete("/core/space/".concat(e,"/kv/").concat(t)),q=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return n.get("/core/space/".concat(e,"/files"),{params:{path:t}})},M=async(e,t)=>n.get("/core/space/".concat(e,"/files/").concat(t,"/download"),{responseType:"blob"}),V=async(e,t)=>n.delete("/core/space/".concat(e,"/files/").concat(t)),$=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=new FormData;return s.append("file",t),s.append("path",a),n.post("/core/space/".concat(e,"/files/upload"),s,{headers:{"Content-Type":"multipart/form-data"}})},G=async function(e,t,a,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";await V(e,t);let c=new File([new Blob([a],{type:"text/plain"})],s,{type:"text/plain"}),o=new FormData;return o.append("file",c),o.append("path",r),n.post("/core/space/".concat(e,"/files/upload"),o,{headers:{"Content-Type":"multipart/form-data"}})},Z=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return n.post("/core/space/".concat(e,"/files/folder"),{name:t,path:a})},W=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments.length>3?arguments[3]:void 0;return n.post("/core/space/".concat(e,"/files/presigned"),{file_name:t,path:a,expiry:s})},X=async(e,t)=>{let a=new FormData;return a.append("file",t),s.A.post("/zz/file/upload-presigned?presigned-key=".concat(e),a,{headers:{"Content-Type":"multipart/form-data"}})},ee=async()=>n.get("/core/capability/types"),et=async(e,t,a)=>n.get("/core/space/".concat(e,"/capabilities"),{params:{...void 0!==t&&{space_id:t},...a&&{capability_type:a}}}),ea=async(e,t)=>n.post("/core/space/".concat(e,"/capabilities"),t),es=async(e,t,a)=>n.put("/core/space/".concat(e,"/capabilities/").concat(t),a),er=async(e,t)=>n.delete("/core/space/".concat(e,"/capabilities/").concat(t)),en=async(e,t,a,s)=>n.get("/core/space/".concat(e,"/users"),{params:{...void 0!==t&&{space_id:t},...void 0!==a&&{user_id:a},...s&&{scope:s}}}),ec=async(e,t)=>n.post("/core/space/".concat(e,"/users"),t),eo=async(e,t,a)=>n.put("/core/space/".concat(e,"/users/").concat(t),a),ei=async(e,t)=>n.delete("/core/space/".concat(e,"/users/").concat(t)),el=async(e,t,a)=>n.get("/core/space/".concat(e,"/events"),{params:{...void 0!==t&&{space_id:t},...a&&{event_key:a}}}),ed=async(e,t)=>n.get("/core/space/".concat(e,"/events/").concat(t)),ep=async(e,t)=>{let a={event_key:t.event_key,target_type:t.target_type,...void 0!==t.space_id&&{space_id:t.space_id},...t.target_endpoint&&{target_endpoint:t.target_endpoint},...t.target_options&&{target_options:"string"==typeof t.target_options?t.target_options:JSON.stringify(t.target_options)},...t.target_code&&{target_code:t.target_code},...void 0!==t.target_space_id&&{target_space_id:t.target_space_id},...t.rules&&{rules:"string"==typeof t.rules?t.rules:JSON.stringify(t.rules)},...t.transform&&{transform:"string"==typeof t.transform?t.transform:JSON.stringify(t.transform)},...void 0!==t.delay_start&&{delay_start:t.delay_start},...void 0!==t.retry_delay&&{retry_delay:t.retry_delay},...void 0!==t.max_retries&&{max_retries:t.max_retries},...t.extrameta&&{extrameta:"string"==typeof t.extrameta?t.extrameta:JSON.stringify(t.extrameta)},...void 0!==t.disabled&&{disabled:t.disabled}};return n.post("/core/space/".concat(e,"/events"),a)},eg=async(e,t,a)=>{let s={};return void 0!==a.event_key&&(s.event_key=a.event_key),void 0!==a.target_type&&(s.target_type=a.target_type),void 0!==a.space_id&&(s.space_id=a.space_id),void 0!==a.target_endpoint&&(s.target_endpoint=a.target_endpoint),void 0!==a.target_options&&(s.target_options="string"==typeof a.target_options?a.target_options:JSON.stringify(a.target_options)),void 0!==a.target_code&&(s.target_code=a.target_code),void 0!==a.rules&&(s.rules="string"==typeof a.rules?a.rules:JSON.stringify(a.rules)),void 0!==a.transform&&(s.transform="string"==typeof a.transform?a.transform:JSON.stringify(a.transform)),void 0!==a.delay_start&&(s.delay_start=a.delay_start),void 0!==a.retry_delay&&(s.retry_delay=a.retry_delay),void 0!==a.max_retries&&(s.max_retries=a.max_retries),void 0!==a.extrameta&&(s.extrameta="string"==typeof a.extrameta?a.extrameta:JSON.stringify(a.extrameta)),void 0!==a.disabled&&(s.disabled=a.disabled),n.put("/core/space/".concat(e,"/events/").concat(t),s)},eu=async(e,t)=>n.delete("/core/space/".concat(e,"/events/").concat(t)),ey=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,a={limit:t};return null!=e&&(a.after_id=e),n.get("/core/user/messages",{params:a})},ef=async()=>n.get("/core/user/messages/new"),em=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return n.get("/core/user/messages/history",{params:{limit:e}})},eh=async e=>n.delete("/core/user/messages/".concat(e)),e_=async e=>n.post("/core/user/messages/".concat(e,"/read")),ex=async()=>n.post("/core/user/messages/read-all"),ev=async()=>n.get("/core/docs/docs_index.json"),eb=async e=>n.get("/core/docs/".concat(e))},3999:(e,t,a)=>{"use strict";a.d(t,{MH:()=>n,NC:()=>r,a1:()=>c});let s="_tnx_login_info_",r=(e,t)=>{localStorage.setItem(s,JSON.stringify({accessToken:e,userInfo:t}))},n=()=>{let e=localStorage.getItem(s);return e?JSON.parse(e):null},c=()=>{localStorage.removeItem(s)}},4678:(e,t,a)=>{"use strict";a.d(t,{$V:()=>r.$V,AC:()=>r.AC,B9:()=>r.B9,Cs:()=>r.Cs,De:()=>r.De,Ed:()=>r.Ed,H1:()=>r.H1,H4:()=>r.H4,K4:()=>r.K4,Kh:()=>r.Kh,Lv:()=>r.Lv,MA:()=>r.MA,MH:()=>s.MH,NC:()=>s.NC,Nv:()=>r.Nv,Om:()=>r.Om,P6:()=>r.P6,Pj:()=>r.Pj,QT:()=>r.QT,Qf:()=>r.Qf,Qk:()=>r.Qk,R5:()=>r.R5,Sx:()=>r.Sx,T:()=>r.T,TT:()=>r.TT,TY:()=>r.TY,Tv:()=>r.Tv,U8:()=>r.U8,VG:()=>r.VG,Y3:()=>r.Y3,ZN:()=>r.ZN,_m:()=>r._m,a1:()=>s.a1,ct:()=>r.ct,e0:()=>r.e0,eK:()=>r.eK,fB:()=>r.fB,iY:()=>r.iY,lB:()=>r.lB,lo:()=>r.lo,q0:()=>r.q0,qf:()=>r.qf,rf:()=>r.rf,s2:()=>r.s2,tF:()=>r.tF,to:()=>r.to,u1:()=>r.u1,uP:()=>r.uP,yn:()=>r.yn,z6:()=>r.z6});var s=a(3999),r=a(1886)},4968:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var s=a(5155),r=a(4678),n=a(5695),c=a(2115);function o(){return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"flex flex-col items-center justify-center h-screen",children:(0,s.jsx)(i,{})})})}let i=()=>{let[e,t]=(0,c.useState)(null),[a,o]=(0,c.useState)("loading"),[i,p]=(0,c.useState)(null),[g,u]=(0,c.useState)(null),[y,f]=(0,c.useState)(!1),[m,h]=(0,c.useState)(null),_=(0,n.useSearchParams)();(0,c.useEffect)(()=>{(async()=>{o("loading"),p(null);let e=_.get("redirect_back_url");if(!e){p("redirect_back_url is not set"),o("error");return}let a=new URL(e);if(!a.pathname.startsWith("/zz/space/")){p("redirect_back_url is not a valid redirect_back_url"),o("error");return}let s=new URL(e).pathname.split("/").pop();if(!s){p("extract space_key failed"),o("error");return}try{let e=await (0,r.De)(s,a.hostname);200===e.status?(t(e.data),o("space_info_loaded")):(p("failed to get space info"),o("error"))}catch(e){console.error(e),p("failed to get space info: "+e),o("error")}})()},[_]),(0,c.useEffect)(()=>{(()=>{let e=(0,r.MH)();(null==e?void 0:e.userInfo)?(u(e.userInfo),f(!0)):f(!1)})()},[]);let x=()=>{let e=_.get("redirect_back_url");if(!e)return void console.log("@redirect_back_url is not set");let t=new URL(e);t.searchParams.set("deny_space_token","true"),window.location.href=t.toString()},v=()=>{let e=_.get("redirect_back_url");if(!e)return void console.log("@redirect_back_url is not set");window.sessionStorage.setItem("redirect_back_url",e);let t=new URL("/zz/pages/auth/login",window.location.origin),a=new URL("/zz/pages/auth/space/in_host",window.location.origin);a.searchParams.set("redirect_back_url",e),t.searchParams.set("after_login_redirect_back_url",a.toString()),window.location.href=t.toString()},b=async()=>{if(!e){p("spaceInfo is not set"),o("error");return}try{o("loading");let t=await (0,r.u1)(e.namespace_key,e.id);200===t.status?(h(t.data.token),o("space_token_loaded")):(p("failed to authorize space"),o("error"))}catch(e){console.error(e),p("failed to authorize space: "+e),o("error")}};return(0,s.jsxs)(s.Fragment,{children:["loading"===a&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{children:"Loading..."})}),"error"===a&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{children:["Error: ",i]})}),"space_info_loaded"===a&&(0,s.jsxs)(s.Fragment,{children:[!y&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(d,{onLogin:v,onDeny:x})}),y&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(l,{spaceInfo:e,onAuthorize:()=>{b()},onDeny:x,onChangeAccount:v,loggedInUser:null==g?void 0:g.name})})]}),"space_token_loaded"===a&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[500px] bg-gray-100 dark:bg-gray-900 p-4",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-md flex flex-col gap-4",children:[(0,s.jsx)("div",{className:"flex mb-6 space-x-4 items-center justify-center",children:(0,s.jsx)("img",{src:"/zz/pages/logo.png",alt:"Turnix Logo",className:"w-10 h-10"})}),(0,s.jsx)("h6",{className:"h4 text-base",children:"Authorized successfully"}),(0,s.jsx)("div",{className:"flex justify-center items-center",children:(0,s.jsx)("button",{onClick:()=>{let t=_.get("redirect_back_url");if(!t)return void console.log("@redirect_back_url is not set");let a=new URL("/zz/pages/auth/space/in_space/post_page",t);a.searchParams.set("redirect_back_url",t),a.searchParams.set("space_token",m),a.searchParams.set("nskey",e.namespace_key),window.location.href=a.toString()},children:"Redirect to space"})})]})})})]})},l=e=>(0,s.jsx)("div",{className:"flex items-center justify-center h-[500px] bg-gray-100 dark:bg-gray-900 p-4",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-md flex flex-col gap-4",children:[(0,s.jsx)("div",{className:"flex mb-6 space-x-4 items-center justify-center",children:(0,s.jsx)("img",{src:"/zz/pages/logo.png",alt:"Turnix Logo",className:"w-10 h-10"})}),(0,s.jsx)("h6",{className:"h4 text-base",children:"Do you want to authorize this space?"}),(0,s.jsx)("div",{className:"flex justify-center items-center",children:(0,s.jsx)("span",{className:"font-light rounded-md bg-gray-100 p-2",children:e.spaceInfo.package_name})}),(0,s.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,s.jsx)("button",{onClick:e.onAuthorize,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out",children:"Authorize"}),(0,s.jsx)("button",{onClick:e.onDeny,className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition duration-150 ease-in-out dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600",children:"Deny"})]}),(0,s.jsxs)("p",{className:"text-center text-sm text-gray-500 dark:text-gray-400",children:["Logged in as ",(0,s.jsx)("span",{className:"font-medium",children:e.loggedInUser}),"."," ",(0,s.jsx)("button",{onClick:e.onChangeAccount,className:"text-blue-600 hover:underline dark:text-blue-400",children:"Change account"})]})]})}),d=e=>(0,s.jsx)("div",{className:"flex items-center justify-center h-[500px] bg-gray-100 dark:bg-gray-900 p-4",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-md flex flex-col gap-4",children:[(0,s.jsx)("div",{className:"flex mb-6 space-x-4 items-center justify-center",children:(0,s.jsx)("img",{src:"/zz/pages/logo.png",alt:"Turnix Logo",className:"w-10 h-10"})}),(0,s.jsx)("h6",{className:"h4 text-base",children:"You are not logged in, Please login first to authorize this space."}),(0,s.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,s.jsx)("button",{onClick:e.onLogin,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out",children:"Login"}),(0,s.jsx)("button",{onClick:e.onDeny,className:"w-full bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition duration-150 ease-in-out dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600",children:"Deny"})]})]})})},5695:(e,t,a)=>{"use strict";var s=a(8999);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})}},e=>{e.O(0,[3464,8441,5964,7358],()=>e(e.s=670)),_N_E=e.O()}]);