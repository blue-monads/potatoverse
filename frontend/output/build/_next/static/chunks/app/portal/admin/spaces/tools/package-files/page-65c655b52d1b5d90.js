(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6596],{6871:(e,t,a)=>{Promise.resolve().then(a.bind(a,7175))},7175:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>N});var l=a(5155),s=a(2115),r=a(1380),i=a(9869),o=a(5968),n=a(4653),c=a(5169),d=a(9890),x=a(3717),h=a(1788),m=a(2525),u=a(5695),g=a(2706),f=a(4678),b=a(7071),p=a(993),j=a(2569);function N(){let e=(0,u.useRouter)(),t=(0,u.useSearchParams)().get("package_version_id");return((0,p.ii)(),t)?(0,l.jsx)(v,{packageId:parseInt(t)}):(0,l.jsx)(g.A,{Icon:r.A,name:"Package Files",description:"Select a package to view files",children:(0,l.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(r.A,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-500",children:"No package selected"}),(0,l.jsx)("button",{onClick:()=>e.back(),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Go Back"})]})})})}let v=e=>{let{packageId:t}=e,[a,d]=(0,s.useState)(""),[x,h]=(0,s.useState)(""),[m,u]=(0,s.useState)("list"),[N,v]=(0,s.useState)(!1),y=(0,s.useRef)(null),k=(0,p.ii)(),A=(0,b.A)({loader:()=>(0,f.MA)(t,a),ready:k.isInitialized,dependencies:[a,x]}),_=(A.data||[]).filter(e=>{let t=e.path===a,l=e.name.toLowerCase().includes(x.toLowerCase());return t&&l}),D=_.filter(e=>e.is_folder),M=_.filter(e=>!e.is_folder),S=a.split("/").filter(Boolean),E=async e=>{try{let a=await (0,f.Tv)(t,e.id),l=window.URL.createObjectURL(new Blob([a.data])),s=document.createElement("a");s.href=l,s.setAttribute("download",e.name),document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(l)}catch(e){console.error("Download failed:",e)}},B=async e=>{if(confirm('Are you sure you want to delete "'.concat(e.name,'"?')))try{await (0,f.e0)(t,e.id),A.reload()}catch(e){console.error("Delete failed:",e)}},P=async e=>{try{let s=await (0,f.Tv)(t,e.id);if(!(s.data instanceof Blob))throw Error("Expected blob response but got something else");let r=await s.data.text();k.modal.openModal({title:"Edit ".concat(e.name),content:(0,l.jsx)(C,{packageId:t,file:e,initialContent:r,currentPath:a,onSave:()=>{A.reload(),k.modal.closeModal()},onCancel:()=>k.modal.closeModal()}),size:"xl"})}catch(e){console.error("Failed to load file for editing:",e),alert("Failed to load file for editing. The file might be too large, not a text file, or corrupted.")}},F=async e=>{let l=e.target.files;if(l&&0!==l.length){v(!0);try{for(let e of Array.from(l))await (0,f.U8)(t,e,a);A.reload()}catch(e){console.error("Upload failed:",e)}finally{v(!1),y.current&&(y.current.value="")}}};return(0,l.jsx)(g.A,{Icon:r.A,name:"Package Files",description:"Managing files for package",rightContent:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("button",{onClick:()=>{var e;return null==(e=y.current)?void 0:e.click()},disabled:N,className:"flex items-center gap-2 px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50",children:[(0,l.jsx)(i.A,{className:"w-4 h-4"}),N?"Uploading...":"Upload"]}),(0,l.jsx)("input",{ref:y,type:"file",multiple:!0,onChange:F,className:"hidden"})]}),children:(0,l.jsxs)("div",{className:"card m-4 p-4 flex flex-col gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between bg-white",children:[(0,l.jsx)("div",{className:"flex w-full",children:(0,l.jsx)(j.A,{searchText:x,setSearchText:h,placeholder:"Search files...",onSearchButtonClick:()=>A.reload(),className:"w-full"})}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("button",{onClick:()=>u("list"),className:"p-2 rounded ".concat("list"===m?"bg-blue-100 text-blue-600":"text-gray-400"),children:(0,l.jsx)(o.A,{className:"w-4 h-4"})}),(0,l.jsx)("button",{onClick:()=>u("grid"),className:"p-2 rounded ".concat("grid"===m?"bg-blue-100 text-blue-600":"text-gray-400"),children:(0,l.jsx)(n.A,{className:"w-4 h-4"})})]})]}),(0,l.jsxs)("nav",{className:"flex items-center space-x-2 text-sm rounded-lg bg-white p-4 border border-gray-200",children:[(0,l.jsx)("button",{onClick:()=>d(""),className:"text-blue-500 hover:text-blue-700",children:"Root"}),S.map((e,t)=>(0,l.jsxs)(s.Fragment,{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"/"}),(0,l.jsx)("button",{onClick:()=>{d(S.slice(0,t+1).join("/"))},className:"text-blue-500 hover:text-blue-700",children:e})]},t))]}),a&&(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsxs)("button",{onClick:()=>{let e=a.split("/");e.pop(),d(e.join("/"))},className:"flex items-center gap-2 text-blue-500 hover:text-blue-700",children:[(0,l.jsx)(c.A,{className:"w-4 h-4"}),"Back"]})}),A.loading?(0,l.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-500",children:"Loading files..."})]})}):0===_.length?(0,l.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(r.A,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-500",children:"No files found"})]})}):(0,l.jsxs)("div",{className:"grid"===m?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4":"space-y-2",children:[D.map(e=>(0,l.jsx)(w,{file:e,viewMode:m,onDoubleClick:()=>(e=>{d(a?"".concat(a,"/").concat(e.name):e.name)})(e),onDownload:()=>{},onEdit:()=>{},onDelete:()=>B(e)},e.id)),M.map(e=>(0,l.jsx)(w,{file:e,viewMode:m,onDoubleClick:()=>E(e),onDownload:()=>E(e),onEdit:()=>P(e),onDelete:()=>B(e)},e.id))]})]})})},w=e=>{let{file:t,viewMode:a,onDoubleClick:i,onDownload:o,onEdit:n,onDelete:c}=e,[u,g]=(0,s.useState)(!1);return"grid"===a?(0,l.jsxs)("div",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer group relative",onDoubleClick:i,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:[(0,l.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,l.jsx)("div",{className:"w-12 h-12 mb-2 flex items-center justify-center",children:t.is_folder?(0,l.jsx)(r.A,{className:"w-8 h-8 text-blue-500"}):(0,l.jsx)(d.A,{className:"w-8 h-8 text-gray-500"})}),(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-900 truncate w-full",children:t.name}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:t.is_folder?"Folder":y(t.size)})]}),u&&!t.is_folder&&(0,l.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1",children:[(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),n()},className:"p-1 bg-white rounded shadow-sm hover:bg-gray-100",title:"Edit file",children:(0,l.jsx)(x.A,{className:"w-3 h-3"})}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),o()},className:"p-1 bg-white rounded shadow-sm hover:bg-gray-100",title:"Download file",children:(0,l.jsx)(h.A,{className:"w-3 h-3"})}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),c()},className:"p-1 bg-white rounded shadow-sm hover:bg-gray-100 text-red-500",title:"Delete file",children:(0,l.jsx)(m.A,{className:"w-3 h-3"})})]})]}):(0,l.jsxs)("div",{className:"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer group",onDoubleClick:i,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:[(0,l.jsx)("div",{className:"flex-shrink-0 mr-3",children:t.is_folder?(0,l.jsx)(r.A,{className:"w-5 h-5 text-blue-500"}):(0,l.jsx)(d.A,{className:"w-5 h-5 text-gray-500"})}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-900 truncate",children:t.name}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:t.is_folder?"Folder":"".concat(y(t.size)," â€¢ ").concat(k(t.created_at))})]}),u&&!t.is_folder&&(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),n()},className:"p-1 hover:bg-gray-200 rounded",title:"Edit file",children:(0,l.jsx)(x.A,{className:"w-4 h-4"})}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),o()},className:"p-1 hover:bg-gray-200 rounded",title:"Download file",children:(0,l.jsx)(h.A,{className:"w-4 h-4"})}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),c()},className:"p-1 hover:bg-gray-200 rounded text-red-500",title:"Delete file",children:(0,l.jsx)(m.A,{className:"w-4 h-4"})})]})]})},y=e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]},k=e=>new Date(e).toLocaleDateString(),C=e=>{let{packageId:t,file:a,initialContent:r,currentPath:i,onSave:o,onCancel:n}=e,[c,d]=(0,s.useState)(r),[x,h]=(0,s.useState)(!1),m=(0,s.useRef)(null);(0,s.useEffect)(()=>{m.current&&m.current.focus()},[]);let u=async()=>{h(!0);try{await (0,f.B9)(t,a.id,c,a.name,i),o()}catch(e){console.error("Failed to save file:",e),alert("Failed to save file. Please try again.")}finally{h(!1)}};return(0,l.jsxs)("div",{className:"flex flex-col h-full max-h-[80vh]",children:[(0,l.jsx)("div",{className:"flex-1 mb-4",children:(0,l.jsx)("textarea",{ref:m,value:c,onChange:e=>d(e.target.value),className:"w-full h-full p-4 border border-gray-300 rounded-lg font-mono text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500",style:{minHeight:"400px"},spellCheck:!1})}),(0,l.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:[c.length," characters"]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:n,disabled:x,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 disabled:opacity-50",children:"Cancel"}),(0,l.jsx)("button",{onClick:u,disabled:x||c===r,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Saving...":"Save"})]})]})]})}}},e=>{e.O(0,[3464,1886,4541,8441,5964,7358],()=>e(e.s=6871)),_N_E=e.O()}]);